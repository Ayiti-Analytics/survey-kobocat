{% load humanize %}
{% load i18n %}

<table class="published_forms__table">
  <thead>
    <tr>
      <th class="published_forms__header published_forms__header--name">{%  trans "Name" %}</th>
      <th class="published_forms__header published_forms__header--submissions">{%  trans "Submissions" %}</th>
      <th class="published_forms__header published_forms__header--entry">{%  trans "Enter Data" %}</th>
      <th class="published_forms__header published_forms__header--view">{%  trans "View" %}</th>
      <th class="published_forms__header published_forms__header--download">{%  trans "Download" %}</th>
      <th class="published_forms__header published_forms__header--lastsubmission">{%  trans "Last Submission" %}</th>
      <th class="published_forms__header published_forms__header--isactive">{%  trans "Active" %}</th>
      <th class="published_forms__header published_forms__header--misc">&nbsp;</th>
    </tr>
  </thead>
  <tbody>


{% for xform in xform_list.xforms %}
  {% with submission_count=xform.submission_count time_of_last_submission=xform.time_of_last_submission has_instances_with_geopoints=xform.has_instances_with_geopoints %}
      <tr class="published_forms__form">
        <td class="published_forms__cell published_forms__cell--name">
            <a href="{% url "onadata.apps.main.views.show" xform.user.username xform.id_string %}">{{ xform.title }}</a> {% if xform_list.id == 'shared'%}<span class="label label-shared">{% trans "Shared by" %} {{ xform.user.username }}</span>
            {% endif %}
            {% if xform.shared %}
                <span class="label label-info label-public">{%  trans "PUBLIC" %}</span>
            {% endif %}
            {% if xform.encrypted %}
                <span class="label label-important icon-lock label-encrypted">&nbsp;&nbsp;{%  trans "ENCRYPTED" %}</span>
            {% endif %}
            <div class="published_forms__form_created">created {{ xform.date_created|date:"N d, Y" }}</div>
        </td>
        <td class="published_forms__cell published_forms__cell--submissions">{{ submission_count|intcomma }}</td>
        <td class="published_forms__cell published_forms__cell--entry">
                <a class="btn" href="{% url "onadata.apps.logger.views.enter_data" xform.user.username xform.id_string %}"><i class="icon-edit"></i> {% trans "Web" %}</a>
        </td>
        <td class="published_forms__cell published_forms__cell--view">
                {% if not xform.encrypted and has_instances_with_geopoints %}
                    <a href="{% url "onadata.apps.viewer.views.map_view" xform.user.username xform.id_string %}" data-original-title="{% trans 'View Map' %}" rel="tooltip">
                        <i class="icon-map-marker icon-large"></i>
                    </a>
                {% else %}
                    <span><i class="icon-map-marker icon-large inactive"></i></span>
                {% endif %}
                {% if  not xform.encrypted and submission_count > 0 %}
                    <a href="{% url "onadata.apps.main.views.form_photos" xform.user.username xform.id_string %}" data-original-title="{% trans 'View Photo' %}" rel="tooltip" >
                    <i class="icon-camera icon-large"></i>
                    <a href="{% url "onadata.apps.viewer.views.data_view" xform.user.username xform.id_string %}" data-original-title="{% trans 'View Submitted Data' %}" rel="tooltip">
                        <i class="icon-list icon-large inactive"></i>
                    </a>
                    <a href="{% url "onadata.apps.viewer.views.stats_tables" xform.user.username xform.id_string %}" data-original-title="{% trans 'View Table Maker' %}" rel="tooltip">
                        <i class="icon-book icon-large inactive"></i>
                    </a>
                    <a href="{% url "form-stats" xform.user.username xform.id_string %}" data-original-title="{% trans 'View Statistics' %}" rel="tooltip">
                    <i class="icon-bar-chart icon-large inactive"></i>
                    </a>
                {% else %}
                    <span><i class="icon-camera icon-large inactive"></i></span>
                    <span><i class="icon-list icon-large inactive"></i></span>
                    <span><i class="icon-bar-chart icon-large inactive"></i></span>
                {% endif %}
        </td>
        <td class="published_forms__cell published_forms__cell--download">
            {% if  not xform.encrypted and submission_count %}
                <a href="{% url "onadata.apps.viewer.views.export_list"  xform.user.username xform.id_string 'csv' %}" class="download"><i class="icon-file-alt"></i> csv</a>
                <a href="{% url "onadata.apps.viewer.views.export_list"  xform.user.username xform.id_string 'xls' %}" class="download"><i class="icon-table"></i> xls</a>
                {% if has_instances_with_geopoints %}
                    <a href="{% url "onadata.apps.viewer.views.kml_export"  xform.user.username xform.id_string %}" class="download"><i class="icon-globe"></i> kml</a>
                {% endif %}
                {% if xform.shared_data %}
                    <span class="label label-info label-public">{%  trans "PUBLIC" %}</span>
                {% endif %}
                {% if xform.encrypted %}
                    <span class="label label-important icon-lock label-encrypted">&nbsp;&nbsp;{%  trans "ENCRYPTED" %}</span>
                {% endif %}
            {% endif %}
        </td>
        <td class="published_forms__cell published_forms__cell--lastsubmission">
          {% if time_of_last_submission %}
              {{ time_of_last_submission|date:"N d, Y" }}
          {% endif %}
        </td>
        <td class="published_forms__cell published_forms__cell--isactive">
          <i class="ikn-active {% if xform.downloadable %}ikn-active--inactive{% endif %}"></i>
        </td>
        </td>
        <td class="published_forms__cell published_forms__cell--misc">
            {% if submission_count <= 0 %}
            <div class="dropdown">i
                <a class="btn btn-flat dropdown-toggle" data-toggle="dropdown" href="#" data-original-title="{% trans 'Options' %}" rel="tooltip">
                    <i class="icon-cog"></i>
                </a>
                    <ul class="dropdown-menu form-options left-arrow" role="menu" aria-labelledby="dropdownMenu">
                        <li><a tabindex="-1" href="#delete-{{ xform.id_string }}" class="confirm" role="button" data-toggle="modal">{% trans 'Delete' %}</a></li>
                        <li><a tabindex="-1" href="#replace-{{ xform.id_string }}" class="confirm" role="button" data-toggle="modal">{% trans 'Replace' %}</a></li>
                    </ul>

                    </div>
            {% endif %}
            {% if submission_count <= 0 %}
                <div id="delete-{{ xform.id_string }}" class="modal hide fade">
                    <form action="{% url "onadata.apps.logger.views.delete_xform" username=xform.user.username id_string=xform.id_string %}" method="post">
                        {% csrf_token %}
                      <div class="modal-header">
                          <a data-dismiss="modal" class="close">&times;</a>
                          <h3>{% trans "Delete Confirmation" %}</h3>
                      </div>
                      <div class="modal-body">
                        <p>{% blocktrans with title=xform.title nb_sub=submission_count|intcomma %}Are you sure you want to delete the form '{{ title }}'? This form has <strong>{{ nb_sub }}</strong> submissions associated with it that will also be deleted. If you are unsure about deleting this form press 'Cancel' and consider 'Archiving' the form instead.{% endblocktrans %}</p>
                      </div>
                      <div class="modal-footer">
                          <button class="btn btn-primary form-submit">Delete</button>
                          <a href="#" data-dismiss="modal" class="btn secondary">Cancel</a>
                      </div>
                    </form>
                </div>
            {% endif %}
              {% if xform.can_be_replaced and xform.user ==  user  %}
                  <div id="xls-update">
                      <div id="replace-{{ xform.id_string }}" class="modal hide fade">
                          <form action="{% url "onadata.apps.main.views.update_xform" xform.user.username xform.id_string %}" method="post" enctype="multipart/form-data">
                              {% csrf_token %}
                              <div class="modal-header">
                                  <a data-dismiss="modal" class="close">&times;</a>
                                  <h3>{% trans "Update XLS" %}</h3>
                              </div>
                              <div class="modal-body">
                                  <input type="file" name="xls_file" id="id_xls_file" />
                                  <input type="submit" class="btn large btn-primary" value="{% trans "Update" %}" data-original-title="" />
                              </div>
                          </form>
                      </div>
                  </div>
              {% endif %}
        </td>
      </tr>
  {% endwith %}
{% endfor %}


  </tbody>
</table>
